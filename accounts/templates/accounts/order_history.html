{% extends 'core/base.html' %}
{% load static %}

{% block title %}Order History - Unique and Antique{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-gray-50 to-white">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-7xl mx-auto">
            <!-- Header Section -->
            <div class="text-center mb-8">
                <div class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-blue-500 to-blue-600 rounded-full mb-4 shadow-lg">
                    <i class="fas fa-history text-white text-2xl"></i>
                </div>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-blue-800 bg-clip-text text-transparent mb-2">
                    Order History
                </h1>
                <p class="text-gray-600 mb-6">Track and manage all your past purchases</p>
                
                <!-- Navigation Breadcrumb -->
                <div class="flex items-center justify-center space-x-2 text-sm text-gray-500 mb-8">
                    <a href="{% url 'accounts:profile' %}" class="hover:text-blue-600 transition-colors">
                        <i class="fas fa-user mr-1"></i>Profile
                    </a>
                    <i class="fas fa-chevron-right text-xs"></i>
                    <span class="text-blue-600 font-medium">Order History</span>
                </div>
            </div>

            <!-- Quick Stats -->
            {% if orders %}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 text-center hover:shadow-xl transition-shadow duration-300">
                    <div class="w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-lg mx-auto mb-3 flex items-center justify-center">
                        <i class="fas fa-check-circle text-white"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">{{ total_orders }}</div>
                    <div class="text-sm text-gray-600">Total Orders</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 text-center hover:shadow-xl transition-shadow duration-300">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg mx-auto mb-3 flex items-center justify-center">
                        <i class="fas fa-shipping-fast text-white"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">{{ total_items }}</div>
                    <div class="text-sm text-gray-600">Items Purchased</div>
                </div>
                <div class="bg-white rounded-xl shadow-lg border border-gray-100 p-6 text-center hover:shadow-xl transition-shadow duration-300">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg mx-auto mb-3 flex items-center justify-center">
                        <i class="fas fa-dollar-sign text-white"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">PKR {{ total_spent|floatformat:2 }}</div>
                    <div class="text-sm text-gray-600">Total Spent</div>
                </div>
            </div>
            {% endif %}
        
        {% if orders %}
            <div class="space-y-8">
                {% for order in orders %}
                <div class="bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden hover:shadow-xl transition-shadow duration-300">
                    <!-- Order Header -->
                    <div class="px-8 py-6 bg-gradient-to-r from-gray-50 to-gray-100 border-b border-gray-200">
                        <div class="flex flex-wrap justify-between items-center">
                            <div class="flex items-center space-x-4">
                                <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-receipt text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-800">Order #{{ order.id }}</h3>
                                    <div class="flex items-center space-x-4 text-sm text-gray-600 mt-1">
                                        <span class="flex items-center">
                                            <i class="fas fa-calendar-alt mr-1"></i>
                                            {{ order.created_at|date:"F d, Y" }}
                                        </span>
                                        <span class="flex items-center">
                                            <i class="fas fa-clock mr-1"></i>
                                            {{ order.created_at|date:"g:i A" }}
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-800 mb-2">PKR {{ order.total|floatformat:2 }}</div>
                                <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold shadow-sm
                                    {% if order.status == 'pending' %}bg-gradient-to-r from-yellow-100 to-yellow-200 text-yellow-800 border border-yellow-300
                                    {% elif order.status == 'processing' %}bg-gradient-to-r from-blue-100 to-blue-200 text-blue-800 border border-blue-300
                                    {% elif order.status == 'shipped' %}bg-gradient-to-r from-purple-100 to-purple-200 text-purple-800 border border-purple-300
                                    {% elif order.status == 'delivered' %}bg-gradient-to-r from-green-100 to-green-200 text-green-800 border border-green-300
                                    {% elif order.status == 'cancelled' %}bg-gradient-to-r from-red-100 to-red-200 text-red-800 border border-red-300
                                    {% else %}bg-gradient-to-r from-gray-100 to-gray-200 text-gray-800 border border-gray-300{% endif %}">
                                    {% if order.status == 'pending' %}<i class="fas fa-hourglass-half mr-2"></i>
                                    {% elif order.status == 'processing' %}<i class="fas fa-cog fa-spin mr-2"></i>
                                    {% elif order.status == 'shipped' %}<i class="fas fa-shipping-fast mr-2"></i>
                                    {% elif order.status == 'delivered' %}<i class="fas fa-check-circle mr-2"></i>
                                    {% elif order.status == 'cancelled' %}<i class="fas fa-times-circle mr-2"></i>
                                    {% else %}<i class="fas fa-question-circle mr-2"></i>{% endif %}
                                    {{ order.get_status_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Order Content -->
                    <div class="px-8 py-6">
                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Order Items -->
                            <div class="lg:col-span-2">
                                <div class="flex items-center mb-4">
                                    <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center mr-3">
                                        <i class="fas fa-box text-white text-sm"></i>
                                    </div>
                                    <h4 class="text-lg font-bold text-gray-800">Items Ordered</h4>
                                </div>
                                <div class="space-y-4">
                                    {% for item in order.items.all %}
                                    <div class="flex items-center p-4 bg-gray-50 rounded-lg border border-gray-200 hover:bg-gray-100 transition-colors">
                                        {% if item.product.image %}
                                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}" 
                                             class="w-16 h-16 object-cover rounded-lg mr-4 border border-gray-300">
                                        {% else %}
                                        <div class="w-16 h-16 bg-gray-300 rounded-lg mr-4 flex items-center justify-center">
                                            <i class="fas fa-image text-gray-500"></i>
                                        </div>
                                        {% endif %}
                                        <div class="flex-1">
                                            <h5 class="font-semibold text-gray-800">{{ item.product_name }}</h5>
                                            <div class="flex items-center space-x-4 mt-1">
                                                <span class="text-sm text-gray-600">
                                                    <i class="fas fa-hashtag mr-1"></i>Qty: {{ item.quantity }}
                                                </span>
                                                <span class="text-sm text-gray-600">
                                                    <i class="fas fa-dollar-sign mr-1"></i>Unit: PKR {{ item.product_price|floatformat:2 }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-lg font-bold text-green-600">PKR {{ item.subtotal|floatformat:2 }}</div>
                                            <div class="text-xs text-gray-500">Subtotal</div>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                            
                            <!-- Shipping & Tracking Information -->
                            <div class="space-y-6">
                                <!-- Shipping Address -->
                                <div>
                                    <div class="flex items-center mb-4">
                                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-map-marker-alt text-white text-sm"></i>
                                        </div>
                                        <h4 class="text-lg font-bold text-gray-800">Shipping Address</h4>
                                    </div>
                                    <div class="bg-gray-50 rounded-lg p-4 border border-gray-200">
                                        <div class="text-sm text-gray-700 space-y-1">
                                            <p class="font-semibold">{{ order.shipping_name }}</p>
                                            <p>{{ order.shipping_address }}</p>
                                            <p>{{ order.shipping_city }}, {{ order.shipping_state }} {{ order.shipping_zip }}</p>
                                            <p>{{ order.shipping_country }}</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Tracking Information -->
                                {% if order.tracking_number %}
                                <div>
                                    <div class="flex items-center mb-4">
                                        <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-truck text-white text-sm"></i>
                                        </div>
                                        <h4 class="text-lg font-bold text-gray-800">Tracking</h4>
                                    </div>
                                    <div class="bg-purple-50 rounded-lg p-4 border border-purple-200">
                                        <div class="flex items-center justify-between">
                                            <div>
                                                <p class="text-sm text-purple-600 font-medium">Tracking Number</p>
                                                <p class="text-purple-800 font-bold">{{ order.tracking_number }}</p>
                                            </div>
                                            <button class="px-3 py-1 bg-purple-600 text-white rounded-lg text-xs hover:bg-purple-700 transition-colors">
                                                Track Package
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                {% endif %}
                                
                                <!-- Payment Method -->
                                <div>
                                    <div class="flex items-center mb-4">
                                        <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center mr-3">
                                            <i class="fas fa-credit-card text-white text-sm"></i>
                                        </div>
                                        <h4 class="text-lg font-bold text-gray-800">Payment</h4>
                                    </div>
                                    <div class="bg-green-50 rounded-lg p-4 border border-green-200">
                                        <div class="flex items-center">
                                            <i class="fas fa-money-bill-wave text-green-600 mr-2"></i>
                                            <span class="text-green-800 font-medium">{{ order.payment_method }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Order Summary -->
                        <div class="mt-8 pt-6 border-t-2 border-gray-200">
                            <div class="flex items-center mb-4">
                                <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-indigo-600 rounded-lg flex items-center justify-center mr-3">
                                    <i class="fas fa-calculator text-white text-sm"></i>
                                </div>
                                <h4 class="text-lg font-bold text-gray-800">Order Summary</h4>
                            </div>
                            <div class="bg-gray-50 rounded-lg p-6 border border-gray-200">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="space-y-3">
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 flex items-center">
                                                <i class="fas fa-shopping-cart mr-2 text-gray-400"></i>Subtotal:
                                            </span>
                                            <span class="font-semibold">PKR {{ order.subtotal|floatformat:2 }}</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 flex items-center">
                                                <i class="fas fa-percent mr-2 text-gray-400"></i>Tax:
                                            </span>
                                            <span class="font-semibold">PKR {{ order.tax|floatformat:2 }}</span>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-gray-600 flex items-center">
                                                <i class="fas fa-truck mr-2 text-gray-400"></i>Shipping:
                                            </span>
                                            <span class="font-semibold">PKR {{ order.shipping_cost|floatformat:2 }}</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-center md:justify-end">
                                        <div class="text-center md:text-right">
                                            <p class="text-sm text-gray-600 mb-1">Total Amount</p>
                                            <p class="text-3xl font-bold text-indigo-600">PKR {{ order.total|floatformat:2 }}</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="mt-6 flex flex-wrap gap-3">
                            {% if order.status == 'delivered' %}
                                <button class="group flex items-center px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg hover:from-blue-700 hover:to-blue-800 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                                    <i class="fas fa-redo mr-2 group-hover:scale-110 transition-transform"></i>
                                    Reorder Items
                                </button>
                                <button class="group flex items-center px-6 py-3 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white rounded-lg hover:from-yellow-600 hover:to-yellow-700 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                                    <i class="fas fa-star mr-2 group-hover:scale-110 transition-transform"></i>
                                    Leave Review
                                </button>
                            {% elif order.status == 'pending' %}
                                <button class="group flex items-center px-6 py-3 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg hover:from-red-700 hover:to-red-800 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                                    <i class="fas fa-times mr-2 group-hover:scale-110 transition-transform"></i>
                                    Cancel Order
                                </button>
                            {% endif %}
                            <a href="{% url 'accounts:order_detail' order.id %}" 
                               class="group flex items-center px-6 py-3 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg hover:from-gray-700 hover:to-gray-800 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                                <i class="fas fa-eye mr-2 group-hover:scale-110 transition-transform"></i>
                                View Details
                            </a>
                            <button class="group flex items-center px-6 py-3 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg hover:from-green-700 hover:to-green-800 font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                                <i class="fas fa-download mr-2 group-hover:scale-110 transition-transform"></i>
                                Download Invoice
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if is_paginated %}
            <div class="mt-12 flex justify-center">
                <nav class="flex items-center space-x-2 bg-white rounded-xl shadow-lg border border-gray-200 p-2">
                    {% if page_obj.has_previous %}
                        <a href="?page=1" class="group flex items-center px-4 py-2 text-sm bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg hover:from-blue-500 hover:to-blue-600 hover:text-white font-medium transition-all duration-200 shadow-sm hover:shadow-md">
                            <i class="fas fa-angle-double-left mr-2 group-hover:scale-110 transition-transform"></i>
                            First
                        </a>
                        <a href="?page={{ page_obj.previous_page_number }}" class="group flex items-center px-4 py-2 text-sm bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg hover:from-blue-500 hover:to-blue-600 hover:text-white font-medium transition-all duration-200 shadow-sm hover:shadow-md">
                            <i class="fas fa-angle-left mr-2 group-hover:scale-110 transition-transform"></i>
                            Previous
                        </a>
                    {% endif %}
                    
                    <span class="flex items-center px-6 py-2 text-sm bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-lg font-bold shadow-md">
                        <i class="fas fa-bookmark mr-2"></i>
                        Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                    </span>
                    
                    {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="group flex items-center px-4 py-2 text-sm bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg hover:from-blue-500 hover:to-blue-600 hover:text-white font-medium transition-all duration-200 shadow-sm hover:shadow-md">
                            Next
                            <i class="fas fa-angle-right ml-2 group-hover:scale-110 transition-transform"></i>
                        </a>
                        <a href="?page={{ page_obj.paginator.num_pages }}" class="group flex items-center px-4 py-2 text-sm bg-gradient-to-r from-gray-100 to-gray-200 text-gray-700 rounded-lg hover:from-blue-500 hover:to-blue-600 hover:text-white font-medium transition-all duration-200 shadow-sm hover:shadow-md">
                            Last
                            <i class="fas fa-angle-double-right ml-2 group-hover:scale-110 transition-transform"></i>
                        </a>
                    {% endif %}
                </nav>
            </div>
            {% endif %}
            
        {% else %}
            <!-- Empty State -->
            <div class="text-center py-16">
                <div class="max-w-lg mx-auto">
                    <div class="inline-flex items-center justify-center w-24 h-24 bg-gradient-to-r from-gray-200 to-gray-300 rounded-full mb-8 shadow-lg">
                        <i class="fas fa-shopping-bag text-4xl text-gray-500"></i>
                    </div>
                    <h3 class="text-3xl font-bold text-gray-800 mb-4">No Orders Yet</h3>
                    <p class="text-lg text-gray-600 mb-8 leading-relaxed">
                        You haven't placed any orders yet. Start exploring our unique collection of antiques and vintage treasures to see your order history here.
                    </p>
                    <div class="space-y-4">
                        <a href="{% url 'products:product_list' %}" 
                           class="group inline-flex items-center px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white rounded-xl hover:from-blue-700 hover:to-blue-800 font-bold text-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
                            <i class="fas fa-shopping-cart mr-3 group-hover:scale-110 transition-transform"></i>
                            Start Shopping
                        </a>
                        <div class="flex justify-center space-x-4 text-sm text-gray-500">
                            <span class="flex items-center">
                                <i class="fas fa-shield-alt mr-1"></i>
                                Secure Checkout
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-truck mr-1"></i>
                                Fast Delivery
                            </span>
                            <span class="flex items-center">
                                <i class="fas fa-undo mr-1"></i>
                                Easy Returns
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        
        <!-- Quick Actions Footer -->
        <div class="mt-12 text-center">
            <div class="inline-flex items-center space-x-4 bg-white rounded-xl shadow-lg border border-gray-200 p-6">
                <a href="{% url 'accounts:profile' %}" 
                   class="group flex items-center px-4 py-2 text-gray-700 hover:text-blue-600 font-medium transition-colors">
                    <i class="fas fa-user mr-2 group-hover:scale-110 transition-transform"></i>
                    Back to Profile
                </a>
                <div class="w-px h-6 bg-gray-300"></div>
                <a href="{% url 'orders:cart' %}" 
                   class="group flex items-center px-4 py-2 text-gray-700 hover:text-blue-600 font-medium transition-colors">
                    <i class="fas fa-shopping-cart mr-2 group-hover:scale-110 transition-transform"></i>
                    View Cart
                </a>
                <div class="w-px h-6 bg-gray-300"></div>
                <a href="{% url 'products:product_list' %}" 
                   class="group flex items-center px-4 py-2 text-gray-700 hover:text-blue-600 font-medium transition-colors">
                    <i class="fas fa-store mr-2 group-hover:scale-110 transition-transform"></i>
                    Continue Shopping
                </a>
            </div>
        </div>
        
        </div>
    </div>
</div>

<!-- Add JavaScript for enhanced interactions -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth scroll behavior for better UX
    document.documentElement.style.scrollBehavior = 'smooth';
    
    // Add loading state for action buttons
    const actionButtons = document.querySelectorAll('button[class*="bg-gradient"]');
    actionButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            if (!this.disabled) {
                const originalText = this.innerHTML;
                this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
                this.disabled = true;
                
                // Re-enable after 3 seconds (for demo purposes)
                setTimeout(() => {
                    this.innerHTML = originalText;
                    this.disabled = false;
                }, 3000);
            }
        });
    });
    
    // Add hover effects for order cards
    const orderCards = document.querySelectorAll('.bg-white.rounded-xl.shadow-lg');
    orderCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Add click-to-copy functionality for tracking numbers
    const trackingNumbers = document.querySelectorAll('.text-purple-800.font-bold');
    trackingNumbers.forEach(element => {
        element.style.cursor = 'pointer';
        element.title = 'Click to copy tracking number';
        
        element.addEventListener('click', function() {
            navigator.clipboard.writeText(this.textContent).then(() => {
                const originalText = this.textContent;
                this.textContent = 'Copied!';
                this.style.color = '#10b981';
                
                setTimeout(() => {
                    this.textContent = originalText;
                    this.style.color = '';
                }, 2000);
            });
        });
    });
});
</script>
{% endblock %}
